# Power BI Visualization Guide for Search Analytics

This guide provides recommended visualizations for analyzing Intranet search behavior using the parquet files generated by the processing script.

---

## Data Sources Setup

### Connecting to Parquet Files
1. **Get Data** > **Parquet**
2. Navigate to `output/` folder
3. Load all three files:
   - `searches_daily.parquet` - Daily aggregated metrics (1 row per day)
   - `searches_journeys.parquet` - Session-level data (1 row per search session)
   - `searches_terms.parquet` - Search term analytics (1 row per term per day)

---

## Important: Handling Pre-Calculated Rates and Averages

### The Aggregation Problem

The daily parquet file contains pre-calculated rate and average columns for convenience when viewing single-day data. However, **these columns cannot be correctly aggregated across multiple days** using simple SUM or AVERAGE functions.

**Why?** Averaging percentages or ratios gives mathematically incorrect results:
- Day 1: 50 clicks / 100 searches = 50% CTR
- Day 2: 10 clicks / 200 searches = 5% CTR
- Wrong: Average of 50% and 5% = 27.5%
- Correct: (50 + 10) / (100 + 200) = 20%

### Columns That Cannot Be Directly Aggregated

| Column | Type | Problem |
|--------|------|---------|
| `click_rate_pct` | Ratio | Cannot average percentages |
| `null_rate_pct` | Ratio | Cannot average percentages |
| `session_success_rate_pct` | Ratio | Cannot average percentages |
| `session_abandonment_rate_pct` | Ratio | Cannot average percentages |
| `avg_searches_per_session` | Average | Cannot average averages |
| `avg_search_term_length` | Average | Cannot average averages |
| `avg_search_term_words` | Average | Cannot average averages |

### Solution: Create DAX Measures

Instead of using the pre-calculated columns, create DAX measures that recalculate from the component columns. The daily file includes all necessary building blocks.

#### Rate Metrics - DAX Formulas

```dax
// Click Rate (clicks per search - can exceed 100% if users click multiple results)
Click Rate % =
DIVIDE(
    SUM(searches_daily[click_events]),
    SUM(searches_daily[search_starts]),
    0
) * 100

// Null Result Rate
Null Rate % =
DIVIDE(
    SUM(searches_daily[null_results]),
    SUM(searches_daily[result_events]),
    0
) * 100

// Session Success Rate (sessions with at least one click / sessions with results)
// Always 0-100% - recommended for KPIs
Session Success Rate % =
DIVIDE(
    SUM(searches_daily[sessions_with_clicks]),
    SUM(searches_daily[sessions_with_results]),
    0
) * 100

// Session Abandonment Rate (sessions with results but no clicks / sessions with results)
// Always 0-100% - recommended for KPIs
Session Abandonment Rate % =
DIVIDE(
    SUM(searches_daily[sessions_abandoned]),
    SUM(searches_daily[sessions_with_results]),
    0
) * 100
```

**Note on Click Rate vs Session Success Rate:**
- `Click Rate %` counts events and can exceed 100% (users clicking multiple results per search)
- `Session Success Rate %` is session-based and always 0-100% (did the session have any clicks?)
- Use **Session Success/Abandonment rates** for executive KPIs

#### Average Metrics - DAX Formulas

```dax
// Average Searches per Session
Avg Searches per Session =
DIVIDE(
    SUM(searches_daily[search_starts]),
    SUM(searches_daily[unique_sessions]),
    0
)

// Average Search Term Length (weighted average using SUM columns)
Avg Search Term Length =
DIVIDE(
    SUM(searches_daily[sum_search_term_length]),
    SUM(searches_daily[search_term_count]),
    0
)

// Average Search Term Words (weighted average using SUM columns)
Avg Search Term Words =
DIVIDE(
    SUM(searches_daily[sum_search_term_words]),
    SUM(searches_daily[search_term_count]),
    0
)
```

### Component Columns Reference

| Metric to Calculate | Numerator Column | Denominator Column |
|---------------------|------------------|-------------------|
| Click Rate % | `click_events` | `search_starts` |
| Null Rate % | `null_results` | `result_events` |
| Session Success Rate % | `sessions_with_clicks` | `sessions_with_results` |
| Session Abandonment Rate % | `sessions_abandoned` | `sessions_with_results` |
| Avg Searches/Session | `search_starts` | `unique_sessions` |
| Avg Search Term Length | `sum_search_term_length` | `search_term_count` |
| Avg Search Term Words | `sum_search_term_words` | `search_term_count` |

### User Cohort Columns (Daily File)

The daily file includes columns for analyzing new vs returning users:

| Column | Type | Description |
|--------|------|-------------|
| `new_users` | Integer | Users whose first search session was on this date |
| `returning_users` | Integer | Users who had searched before this date |

**DAX Measures for User Cohorts:**

```dax
// New User Percentage (daily)
New User % =
DIVIDE(
    SUM(searches_daily[new_users]),
    SUM(searches_daily[unique_users]),
    0
) * 100

// Returning User Percentage (daily)
Returning User % =
DIVIDE(
    SUM(searches_daily[returning_users]),
    SUM(searches_daily[unique_users]),
    0
) * 100
```

### When to Use Pre-Calculated vs DAX Measures

| Scenario | Use Pre-Calculated Column | Use DAX Measure |
|----------|---------------------------|-----------------|
| Single day view (date slicer = 1 day) | OK | OK |
| Multiple days aggregated | NO | YES |
| Weekly/Monthly totals | NO | YES |
| Filtering by other dimensions | NO | YES |
| Quick glance at daily table | OK | OK |

### Best Practice

**Always use DAX measures for KPI tiles and aggregated views.** The pre-calculated columns are useful for:
- Quick reference in detailed daily tables
- Validation that your DAX measures match single-day values
- Export to other tools that will handle aggregation separately

---

## Page 1: Executive Dashboard (Daily Metrics)

### Row 1: KPI Tiles

| Tile | Measure | Description |
|------|---------|-------------|
| **Total Searches** | `SUM(search_starts)` | Total search queries |
| **Unique Users** | `SUM(unique_users)` | Distinct users who searched |
| **Session Success Rate** | See DAX below | Percentage of sessions with results that had clicks |
| **Null Result Rate** | See DAX below | Percentage of searches with zero results |
| **Session Abandonment Rate** | See DAX below | Percentage of sessions with results but no clicks |

#### DAX Measures for Correct Aggregation

```dax
// Session Success Rate (always 0-100%)
Session Success Rate % =
DIVIDE(
    SUM(searches_daily[sessions_with_clicks]),
    SUM(searches_daily[sessions_with_results]),
    0
) * 100

// Session Abandonment Rate (always 0-100%)
Session Abandonment Rate % =
DIVIDE(
    SUM(searches_daily[sessions_abandoned]),
    SUM(searches_daily[sessions_with_results]),
    0
) * 100

// Null Result Rate
Null Rate % =
DIVIDE(
    SUM(searches_daily[null_results]),
    SUM(searches_daily[result_events]),
    0
) * 100

// Click Rate (can exceed 100% - multiple clicks per search)
Click Rate % =
DIVIDE(
    SUM(searches_daily[click_events]),
    SUM(searches_daily[search_starts]),
    0
) * 100

// Average Searches per Session
Avg Searches/Session =
DIVIDE(
    SUM(searches_daily[search_starts]),
    SUM(searches_daily[unique_sessions]),
    0
)

// Average Search Term Length (weighted)
Avg Search Term Length =
DIVIDE(
    SUM(searches_daily[sum_search_term_length]),
    SUM(searches_daily[search_term_count]),
    0
)
```

### Row 2: Trend Charts

#### Chart 1: Search Volume Over Time
- **Type**: Line Chart
- **X-Axis**: `date`
- **Y-Axis**: `search_starts`
- **Secondary Y-Axis** (optional): `unique_users`

#### Chart 2: Quality Metrics Over Time
- **Type**: Line Chart (multiple series)
- **X-Axis**: `date`
- **Lines**:
  - `Session Success Rate %` (DAX measure)
  - `Null Rate %` (DAX measure)
  - `Session Abandonment Rate %` (DAX measure)

### Row 3: Click Distribution

#### Chart 3: Clicks by Category
- **Type**: Stacked Bar Chart or Donut
- **Values**:
  - `clicks_general`
  - `clicks_all`
  - `clicks_news`
  - `clicks_goto`
  - `clicks_people`

#### Chart 4: Daily Activity Table
- **Type**: Table
- **Columns**: `date`, `search_starts`, `unique_users`, `Session Success Rate %`, `Null Rate %`
- **Conditional Formatting**: Highlight low success rates or high null rates

### Row 4: Temporal Patterns

#### Chart 5: Searches by Day of Week
- **Type**: Bar Chart
- **Setup**:
  1. Drag `day_of_week` to **Axis**
  2. Drag `search_starts` to **Values** → select **Sum**
- **Sort**: By `day_of_week_num` (configure in Model view: select `day_of_week`, set "Sort by column" to `day_of_week_num`)
- **Insight**: Identify busiest days - weekday vs weekend patterns

#### Chart 6: Search Time Distribution
- **Type**: Stacked Bar or Pie Chart
- **Values** (all from daily file):
  - `searches_morning` (6:00-12:00)
  - `searches_afternoon` (12:00-18:00)
  - `searches_evening` (18:00-24:00)
  - `searches_night` (0:00-6:00)
- **Insight**: When do users search most? Morning rush, lunch break, end of day?

---

## Page 2: User Journey Analysis (Session Metrics)

### Understanding the Journeys File

The `searches_journeys.parquet` file contains **one row per session**. Each row represents a complete user journey from first search to last action.

**Key columns:**

| Column | Type | Description |
|--------|------|-------------|
| `session_date` | Date | Date of the session |
| `journey_outcome` | String | Success, Abandoned, No Results, Unknown |
| `search_count_in_session` | Integer | Number of searches in this session |
| `result_count` | Integer | Number of SEARCH_RESULT_COUNT events |
| `click_count` | Integer | Number of clicks |
| `null_result_count` | Integer | Number of searches with 0 results |
| `had_reformulation` | Boolean | Did user search multiple different terms? |
| `session_complexity` | String | Single Event, Simple, Medium, Complex |
| `search_to_result_bucket` | String | Time bucket for search-to-result |
| `result_to_click_bucket` | String | Time bucket for result-to-click |
| `session_duration_bucket` | String | Time bucket for total session duration |
| `sec_search_to_result` | Decimal | Seconds from search to result |
| `sec_result_to_click` | Decimal | Seconds from result to click |
| `total_duration_sec` | Decimal | Total session duration in seconds |
| `search_to_result_sort` | Integer | Sort order for search_to_result_bucket |
| `result_to_click_sort` | Integer | Sort order for result_to_click_bucket |
| `session_duration_sort` | Integer | Sort order for session_duration_bucket |
| `journey_outcome_sort` | Integer | Sort order for journey_outcome |
| `session_complexity_sort` | Integer | Sort order for session_complexity |
| `had_null_result` | Boolean | Did session have any null result? |
| `recovered_from_null` | Boolean | Had null result but still clicked (recovered) |
| `user_session_number` | Integer | Which session is this for the user (1, 2, 3...) |
| `is_users_first_session` | Boolean | Is this the user's first session in dataset? |
| `distinct_click_categories` | Integer | Number of different click types in session |
| `had_tab_switch` | Boolean | Did user click on multiple tabs/categories? |

### DAX Measures for Journeys

Create these measures for the journeys visualizations:

```dax
// Basic session count
Session Count = COUNTROWS(searches_journeys)

// Journey Outcome Counts
Success Sessions =
CALCULATE(
    COUNTROWS(searches_journeys),
    searches_journeys[journey_outcome] = "Success"
)

Abandoned Sessions =
CALCULATE(
    COUNTROWS(searches_journeys),
    searches_journeys[journey_outcome] = "Abandoned"
)

No Results Sessions =
CALCULATE(
    COUNTROWS(searches_journeys),
    searches_journeys[journey_outcome] = "No Results"
)

// Journey Outcome Rates
Success Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[journey_outcome] = "Success"),
    COUNTROWS(searches_journeys),
    0
) * 100

Abandonment Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[journey_outcome] = "Abandoned"),
    COUNTROWS(searches_journeys),
    0
) * 100

No Results Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[journey_outcome] = "No Results"),
    COUNTROWS(searches_journeys),
    0
) * 100

// Reformulation Rate
Reformulation Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[had_reformulation] = TRUE()),
    COUNTROWS(searches_journeys),
    0
) * 100

// Average Timing Metrics
Avg Search to Result (sec) =
AVERAGE(searches_journeys[sec_search_to_result])

Avg Result to Click (sec) =
AVERAGE(searches_journeys[sec_result_to_click])

Avg Session Duration (sec) =
AVERAGE(searches_journeys[total_duration_sec])

// Average Searches per Session (from journeys)
Avg Searches per Session (Journeys) =
AVERAGE(searches_journeys[search_count_in_session])

// Null Result Recovery Rate - sessions that had null result but still succeeded
Null Recovery Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[recovered_from_null] = TRUE()),
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[had_null_result] = TRUE()),
    0
) * 100

// First-time User Success Rate
First-Time User Success Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys),
        searches_journeys[is_users_first_session] = TRUE(),
        searches_journeys[journey_outcome] = "Success"),
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[is_users_first_session] = TRUE()),
    0
) * 100

// Returning User Success Rate
Returning User Success Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys),
        searches_journeys[is_users_first_session] = FALSE(),
        searches_journeys[journey_outcome] = "Success"),
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[is_users_first_session] = FALSE()),
    0
) * 100

// Tab Switch Rate
Tab Switch Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_journeys), searches_journeys[had_tab_switch] = TRUE()),
    COUNTROWS(searches_journeys),
    0
) * 100
```

### Journey Types Analysis

The Journey Types view provides a human-readable summary of session patterns, showing exactly what happened in each session (e.g., "1 Search → 1 Result → 1 Click").

**Step 1: Create a Calculated Column** (Model view → `searches_journeys` → New Column)

```dax
Journey_Type =
VAR searches = [search_count_in_session]
VAR results = [result_count]
VAR clicks = [click_count]
VAR nulls = [null_result_count]
RETURN
SWITCH(
    TRUE(),
    searches > 0 && results > 0 && clicks > 0,
        searches & " Search → " & results & " Result → " & clicks & " Click",
    searches > 0 && results > 0 && nulls > 0 && clicks = 0,
        searches & " Search → " & results & " Result (incl. " & nulls & " null) → No Click",
    searches > 0 && results > 0 && clicks = 0,
        searches & " Search → " & results & " Result → Abandoned",
    searches > 0 && results = 0,
        searches & " Search → No Result",
    "Other"
)
```

**Step 2: Create a Percentage Measure** (optional)

```dax
Journey Type % =
DIVIDE(
    COUNTROWS(searches_journeys),
    CALCULATE(COUNTROWS(searches_journeys), ALL(searches_journeys[Journey_Type])),
    0
) * 100
```

**Step 3: Create the Visualization**

- **Type**: Table or Horizontal Bar Chart
- **Setup for Table**:
  1. Drag `Journey_Type` to **Columns**
  2. Add count of `Journey_Type` (Sessions)
  3. Add `Journey Type %` measure
  4. Sort by Sessions descending
- **Setup for Bar Chart**:
  1. Drag `Journey_Type` to **Y-axis**
  2. Count of `Journey_Type` to **X-axis**
  3. Sort by value descending

**Example Output:**

| Journey_Type | Sessions | % |
|--------------|----------|---|
| 1 Search → 1 Result → 1 Click | 1,245 | 45.2% |
| 1 Search → 1 Result → Abandoned | 532 | 19.3% |
| 2 Search → 2 Result → 1 Click | 289 | 10.5% |
| 1 Search → 1 Result (incl. 1 null) → No Click | 156 | 5.7% |
| 1 Search → No Result | 98 | 3.6% |

**What this tells you:**
- **Ideal pattern**: "1 Search → 1 Result → 1 Click" (user found what they needed immediately)
- **Refinement needed**: "2+ Search" patterns indicate users had to refine their query
- **Content gap**: "No Result" patterns suggest missing content
- **Relevance issue**: "Abandoned" patterns suggest results weren't relevant

### Setting Up Sort Order for Columns

The bucket and category columns are text and won't sort correctly by default (e.g., "10-30s" would come before "2-5s" alphabetically). The parquet file includes sort order columns to fix this.

**To configure "Sort by column" in Power BI:**

1. Go to **Model view** (left sidebar)
2. Select the text column you want to sort (e.g., `journey_outcome`)
3. In the **Properties** pane, find **Sort by column**
4. Select the corresponding sort column (e.g., `journey_outcome_sort`)

**Column mappings:**

| Text Column | Sort By Column | Table |
|-------------|----------------|-------|
| `journey_outcome` | `journey_outcome_sort` | searches_journeys |
| `session_complexity` | `session_complexity_sort` | searches_journeys |
| `search_to_result_bucket` | `search_to_result_sort` | searches_journeys |
| `result_to_click_bucket` | `result_to_click_sort` | searches_journeys |
| `session_duration_bucket` | `session_duration_sort` | searches_journeys |
| `Query_Length_Bucket` | `Query_Length_Sort` | searches_terms (calculated) |

Once configured, the text columns will sort in logical order everywhere they're used.

### Row 1: Journey Outcomes

#### Chart 1: Journey Outcome Distribution
- **Type**: Donut Chart
- **Setup**:
  1. Drag `journey_outcome` to **Legend**
  2. Drag `journey_outcome` to **Values** → select **Count**
- **Colors**:
  - Success = Green (#2E7D32)
  - Abandoned = Orange (#F57C00)
  - No Results = Red (#C62828)
  - Unknown = Gray (#757575)
- **Sort**: Configured via "Sort by column" (see above)

#### Chart 2: Session Complexity Breakdown
- **Type**: Bar Chart
- **Setup**:
  1. Drag `session_complexity` to **Axis**
  2. Drag `session_complexity` to **Values** → select **Count**
- **Sort**: Configured via "Sort by column" (see above)

### Row 2: Timing Analysis

#### Chart 3: Search-to-Result Time Distribution
- **Type**: Bar Chart (Clustered Bar)
- **Setup**:
  1. Drag `search_to_result_bucket` to **Axis**
  2. Drag `search_to_result_bucket` to **Values** → select **Count**
- **Sort**: Configured via "Sort by column" (see above)
- **Insight**: Shows system performance - ideally most sessions should be < 2s

#### Chart 4: Result-to-Click Time Distribution
- **Type**: Bar Chart (Clustered Bar)
- **Setup**:
  1. Drag `result_to_click_bucket` to **Axis**
  2. Drag `result_to_click_bucket` to **Values** → select **Count**
- **Sort**: Configured via "Sort by column" (see above)
- **Insight**: Shows user decision time - quick clicks may indicate good relevance

### Row 3: Behavior Patterns

#### Chart 5: Reformulation Rate
- **Type**: Card or KPI
- **Setup**: Use the `Reformulation Rate %` measure
- **Target**: < 30% is good (users find what they need on first try)
- **Insight**: High reformulation suggests search relevance issues

#### Chart 6: Session Duration Distribution
- **Type**: Bar Chart
- **Setup**:
  1. Drag `session_duration_bucket` to **Axis**
  2. Drag `session_duration_bucket` to **Values** → select **Count**
- **Sort**: Configured via "Sort by column" (see above)
- **Insight**: Very short sessions might be quick successes OR immediate abandonment

### Row 4: KPI Cards (Optional)

Create a row of KPI cards for quick insights:

| Card | Measure | Target |
|------|---------|--------|
| Total Sessions | `Session Count` | - |
| Success Rate | `Success Rate %` | > 40% |
| Avg Searches/Session | `Avg Searches per Session (Journeys)` | < 2 |
| Reformulation Rate | `Reformulation Rate %` | < 30% |
| Avg Time to Click | `Avg Result to Click (sec)` | < 10s |

---

## Page 3: Deep Dive Analysis

### Filters Panel
Add slicers for:
- `session_date` (date range)
- `journey_outcome`
- `session_complexity`
- `search_to_result_bucket`

### Chart 1: Heatmap - Hour of Day Activity
- **Type**: Matrix
- **Rows**: Day of week (from `session_date`)
- **Columns**: `first_event_hour`
- **Values**: Count of sessions
- **Conditional Formatting**: Heat colors

### Chart 2: Click Category by Outcome
- **Type**: Stacked Bar Chart
- **Axis**: `journey_outcome`
- **Legend**: Click type columns
- **Values**: Sum of click counts

### Chart 3: Sessions with Multiple Searches
- **Type**: Histogram or Bar
- **Axis**: `search_count_in_session` (grouped into bins)
- **Values**: Count of sessions
- **Insight**: How often users need multiple searches

---

## Page 4: Search Terms Analysis

### Understanding the Terms File

The `searches_terms.parquet` file contains **one row per search term per day**. It enables analysis of which terms users search for and how successful those searches are.

**Key columns:**

| Column | Type | Description |
|--------|------|-------------|
| `session_date` | Date | Date |
| `search_term` | String | The normalized search query |
| `word_count` | Integer | Number of words in search term |
| `search_count` | Integer | Times this term was searched |
| `unique_users` | Integer | Distinct users who searched this |
| `unique_sessions` | Integer | Sessions containing this term |
| `result_events` | Integer | Result count events for this term |
| `null_result_count` | Integer | Searches returning 0 results |
| `click_count` | Integer | Clicks attributed to this term |
| `clicks_general` | Integer | General tab clicks |
| `clicks_all` | Integer | All tab clicks |
| `clicks_news` | Integer | News tab clicks |
| `clicks_goto` | Integer | GoTo clicks |
| `clicks_people` | Integer | People clicks |
| `avg_sec_to_click` | Float | Average seconds from result to click |
| `clicks_with_timing` | Integer | Clicks with timing data (for weighting) |
| `sum_sec_to_click` | Float | Sum of seconds to click (for weighted avg) |
| `searches_morning` | Integer | Searches 6:00-12:00 |
| `searches_afternoon` | Integer | Searches 12:00-18:00 |
| `searches_evening` | Integer | Searches 18:00-24:00 |
| `searches_night` | Integer | Searches 0:00-6:00 |
| `first_seen_date` | Date | First date this term appeared in dataset |
| `is_new_term` | Boolean | Is this the first day this term was searched? |

### DAX Measures for Search Terms

```dax
// Total searches for all terms
Total Term Searches = SUM(searches_terms[search_count])

// Term CTR (Click-through rate)
Term CTR % =
DIVIDE(
    SUM(searches_terms[click_count]),
    SUM(searches_terms[search_count]),
    0
) * 100

// Zero Result Rate for terms
Term Zero Result Rate % =
DIVIDE(
    SUM(searches_terms[null_result_count]),
    SUM(searches_terms[result_events]),
    0
) * 100

// Term Abandonment Rate (had results but no click)
Term Abandonment Rate % =
DIVIDE(
    SUM(searches_terms[result_events]) - SUM(searches_terms[null_result_count]) - SUM(searches_terms[click_count]),
    SUM(searches_terms[result_events]) - SUM(searches_terms[null_result_count]),
    0
) * 100

// Unique Terms Count
Unique Terms = DISTINCTCOUNT(searches_terms[search_term])

// Weighted Average Time to Click (seconds)
// Uses SUM columns for proper aggregation across dates/terms
Avg Time to Click (sec) =
DIVIDE(
    SUM(searches_terms[sum_sec_to_click]),
    SUM(searches_terms[clicks_with_timing]),
    BLANK()
)

// Query Length Bucket - see "Query Length vs Success Analysis" section below
// for both the bucket column and the sort column definitions

// New Terms Count (terms first seen on selected date range)
New Terms Count =
CALCULATE(
    DISTINCTCOUNT(searches_terms[search_term]),
    searches_terms[is_new_term] = TRUE()
)

// New Term Rate (what % of today's terms are new)
New Term Rate % =
DIVIDE(
    CALCULATE(COUNTROWS(searches_terms), searches_terms[is_new_term] = TRUE()),
    COUNTROWS(searches_terms),
    0
) * 100
```

### Query Length vs Success Analysis

Use the `word_count` column to understand if longer queries perform better.

**Step 1: Create the Bucket Calculated Column** (Model view → `searches_terms` → New Column):
```dax
Query_Length_Bucket =
SWITCH(
    TRUE(),
    searches_terms[word_count] = 1, "1 word",
    searches_terms[word_count] = 2, "2 words",
    searches_terms[word_count] = 3, "3 words",
    searches_terms[word_count] = 4, "4 words",
    searches_terms[word_count] >= 5, "5+ words",
    "Unknown"
)
```

**Step 2: Create the Sort Column** (Model view → `searches_terms` → New Column):
```dax
Query_Length_Sort =
SWITCH(
    TRUE(),
    searches_terms[word_count] = 1, 1,
    searches_terms[word_count] = 2, 2,
    searches_terms[word_count] = 3, 3,
    searches_terms[word_count] = 4, 4,
    searches_terms[word_count] >= 5, 5,
    99
)
```

**Step 3: Configure Sort Order**
1. Go to **Model view** (left sidebar)
2. Select `Query_Length_Bucket` column
3. In **Column tools** ribbon → click **Sort by column**
4. Select `Query_Length_Sort`

Now your bar charts will sort correctly: 1 word → 2 words → 3 words → 4 words → 5+ words

**Visualization: CTR by Query Length**
- **Type**: Bar Chart
- **Setup**:
  1. Drag `Query_Length_Bucket` to **Axis**
  2. Drag `Term CTR %` measure to **Values**
- **Sort**: Already configured via "Sort by column"
- **Insight**: Do longer, more specific queries have higher CTR?

**Visualization: Null Rate by Query Length**
- **Type**: Bar Chart
- **Setup**:
  1. Drag `Query_Length_Bucket` to **Axis**
  2. Drag `Term Zero Result Rate %` measure to **Values**
- **Sort**: Already configured via "Sort by column"
- **Insight**: Do very specific (4+ word) queries fail more often?

**Expected Pattern:**
| Word Count | Typical CTR | Typical Null Rate | Interpretation |
|------------|-------------|-------------------|----------------|
| 1 word | Low (15-20%) | Low (5-8%) | Vague queries, many results but poor match |
| 2-3 words | High (25-40%) | Low (3-6%) | Optimal specificity |
| 4+ words | Medium (20-30%) | Higher (10-15%) | Very specific, may not find exact match |

### Row 1: Top Search Terms

#### Chart 1: Top 20 Search Terms by Volume
- **Type**: Bar Chart (Horizontal)
- **Setup**:
  1. Drag `search_term` to **Y-axis**
  2. Drag `search_count` to **X-axis** → select **Sum**
  3. Add a **Top N filter** on `search_term` = Top 20 by Sum of `search_count`
- **Sort**: By X-axis values descending

#### Chart 2: Search Term Word Cloud (Optional)
- **Type**: Word Cloud (requires custom visual from AppSource)
- **Category**: `search_term`
- **Values**: `search_count`
- **Note**: Install "Word Cloud" from Power BI AppSource

### Row 2: Problem Terms (Actionable Insights)

#### Chart 3: Terms with High Zero Result Rate
- **Type**: Table
- **Columns**: `search_term`, Sum of `search_count`, `Term Zero Result Rate %`
- **Filter**: `Term Zero Result Rate %` > 50 AND Sum of `search_count` > 5
- **Insight**: Content gaps - these terms need content created

#### Chart 4: High Volume + Low CTR Terms
- **Type**: Table
- **Columns**: `search_term`, Sum of `search_count`, `Term CTR %`
- **Filter**: `Term CTR %` < 20 AND Sum of `search_count` > 10 AND `Term Zero Result Rate %` < 50
- **Insight**: Relevance problems - results exist but don't match user intent

### Row 3: Success Stories

#### Chart 5: High Performing Terms
- **Type**: Table
- **Columns**: `search_term`, Sum of `search_count`, `Term CTR %`
- **Filter**: `Term CTR %` > 50 AND Sum of `search_count` > 10
- **Insight**: Learn from these - what makes them successful?

#### Chart 6: Search Term Trend (Selected Term)
- **Type**: Line Chart
- **Setup**:
  1. Drag `session_date` to **X-axis**
  2. Drag `search_count` to **Y-axis** → select **Sum**
  3. Add a slicer for `search_term` to filter to specific terms
- **Insight**: Track popularity of specific terms over time

### Row 4: KPI Cards

| Card | Measure | Description |
|------|---------|-------------|
| Unique Terms | `Unique Terms` | Total distinct search terms |
| Avg CTR | `Term CTR %` | Overall click-through rate |
| Zero Result Rate | `Term Zero Result Rate %` | % of searches with no results |
| Top Term | First value of `search_term` sorted by `search_count` | Most searched term |

### Key Questions This Page Answers

1. **What are users searching for?** - Top search terms by volume
2. **What content is missing?** - Terms with high zero result rate
3. **Where is relevance poor?** - High volume terms with low CTR
4. **What's working well?** - High CTR terms to learn from
5. **Are search patterns changing?** - Term trends over time
6. **Do longer queries perform better?** - Query length vs CTR/null rate analysis

---

## Page 5: Advanced Analytics

This page focuses on deeper behavioral insights: user cohorts, recovery patterns, and emerging trends.

### Row 1: User Cohort Analysis

#### Chart 1: New vs Returning Users Trend
- **Type**: Stacked Area Chart
- **Setup**:
  1. Drag `date` to **X-axis**
  2. Add `new_users` and `returning_users` to **Values**
- **Insight**: Track user acquisition and retention patterns

#### Chart 2: First-Time vs Returning User Success Comparison
- **Type**: Clustered Bar Chart
- **Setup**:
  1. Create a bar for `First-Time User Success Rate %` measure
  2. Create a bar for `Returning User Success Rate %` measure
- **Alternative**: Use a KPI card comparison
- **Insight**: Do experienced users perform better? If so, there may be a learning curve for the search interface.

### Row 2: Null Result Recovery Analysis

#### Chart 3: Null Recovery Rate KPI
- **Type**: KPI Card
- **Setup**: Use the `Null Recovery Rate %` measure
- **Target**: > 50% is good (users recovered despite initial failure)
- **Insight**: Measures resilience - can users succeed even when initial search fails?

#### Chart 4: Recovery Funnel
- **Type**: Funnel Chart
- **Setup**:
  1. Stage 1: Sessions with null results (`had_null_result = TRUE`)
  2. Stage 2: Recovered sessions (`recovered_from_null = TRUE`)
- **DAX for filtering**:
```dax
Sessions with Null =
CALCULATE(COUNTROWS(searches_journeys), searches_journeys[had_null_result] = TRUE())

Sessions Recovered =
CALCULATE(COUNTROWS(searches_journeys), searches_journeys[recovered_from_null] = TRUE())
```
- **Insight**: Visual representation of how many null-result sessions eventually succeed

### Row 3: Session Flow Patterns

#### Chart 5: Tab Switching Analysis
- **Type**: Clustered Bar Chart
- **Setup**:
  1. Drag `journey_outcome` to **Axis**
  2. Create two measures: sessions with `had_tab_switch = TRUE` vs `FALSE`
- **Insight**: Do users who switch tabs have different success rates?

#### Chart 6: Click Categories Distribution
- **Type**: Histogram
- **Setup**:
  1. Drag `distinct_click_categories` to **Axis**
  2. Count of sessions to **Values**
- **Insight**: Most users should have 1-2 categories; many with 3+ may indicate confusion

### Row 4: Term Trend Detection

#### Chart 7: New Terms Over Time
- **Type**: Line Chart
- **Setup**:
  1. Drag `session_date` to **X-axis**
  2. Use `New Terms Count` measure as **Values**
- **Insight**: Spike in new terms may indicate emerging topics or organizational changes

#### Chart 8: Recently Emerged Terms Table
- **Type**: Table
- **Columns**: `search_term`, `first_seen_date`, Sum of `search_count`, `Term CTR %`
- **Filter**: `first_seen_date` >= DATE (recent, e.g., last 7 days)
- **Sort**: By Sum of `search_count` descending
- **Insight**: Identify trending new topics that may need content attention

### Key Insights This Page Provides

| Question | Metric | Action |
|----------|--------|--------|
| Are new users struggling? | Compare first-time vs returning success | Improve onboarding, add search tips |
| Can users recover from failed searches? | Null Recovery Rate % | If low, improve suggestions/synonyms |
| Are users confused about tab navigation? | Tab Switch Rate % | If high, reconsider tab organization |
| What new topics are emerging? | New Terms list | Create content for trending terms |

---

## Key Questions This Dashboard Answers

### Daily Trends
1. **How many searches happen per day?** - Search volume trend
2. **Are users finding what they need?** - Click-through rate trend
3. **Is content missing?** - Null result rate trend
4. **What content types are most clicked?** - Click category breakdown

### User Behavior
1. **What percentage of searches succeed?** - Journey outcome distribution
2. **How complex are search sessions?** - Session complexity breakdown
3. **Do users refine their searches?** - Reformulation rate
4. **How long do users take to decide?** - Result-to-click timing

### System Performance
1. **How fast do results appear?** - Search-to-result timing
2. **Are there performance issues?** - Sessions in slow timing buckets

### Temporal Patterns
1. **Which days are busiest?** - `day_of_week` in daily file
2. **When do users search?** - `searches_morning`, `searches_afternoon`, `searches_evening`, `searches_night`
3. **When is a specific term searched?** - Hour distribution per term in terms file

### User Cohorts & Behavior
1. **Are new users struggling?** - Compare `First-Time User Success Rate %` vs `Returning User Success Rate %`
2. **How is user acquisition trending?** - `new_users` vs `returning_users` over time
3. **Can users recover from failed searches?** - `Null Recovery Rate %`
4. **Do users switch tabs to find content?** - `Tab Switch Rate %`, `distinct_click_categories`

### Term Trends
1. **What new topics are emerging?** - Filter by `is_new_term = TRUE`, sort by volume
2. **When did a term first appear?** - `first_seen_date` in terms file
3. **Is search vocabulary expanding?** - `New Terms Count` measure over time

---

## Recommended Alerts

Set up Power BI alerts for:

| Alert | Threshold | Meaning |
|-------|-----------|---------|
| Null Rate Spike | > 15% | Content gap or search issues |
| Session Success Drop | < 30% | Results not matching user intent |
| Session Abandonment Spike | > 70% | Results showing but not useful |
| Slow Results | > 10% in "> 5s" bucket | System performance issue |

---

## Color Scheme Recommendations

| Metric Type | Good | Warning | Bad |
|-------------|------|---------|-----|
| Session Success Rate % | > 40% (Green) | 25-40% (Yellow) | < 25% (Red) |
| Null Rate % | < 5% (Green) | 5-15% (Yellow) | > 15% (Red) |
| Session Abandonment % | < 50% (Green) | 50-70% (Yellow) | > 70% (Red) |
| Click Rate % | > 30% (Green) | 15-30% (Yellow) | < 15% (Red) |

---

## Tips for Effective Analysis

1. **Compare weekdays vs weekends** - Search patterns differ
2. **Filter by time of day** - Peak hours may show different behavior
3. **Track reformulation rate** - High rates suggest search UI/relevance issues
4. **Monitor null results** - These are opportunities to improve content
5. **Watch for "quick clicks" (< 2s)** - May indicate good results OR users just clicking first result
6. **Look for "extended sessions" (> 5 min)** - Users may be struggling to find content

---

## Sample Report Layout

```
+------------------------------------------------------------------------+
|  [Total Searches]  [Unique Users]  [Success %]  [Null %]  [Abandon %]  |
+------------------------------------------------------------------------+
|                                          |                              |
|     Search Volume Over Time              |   Click Category             |
|     (Line Chart)                         |   Distribution               |
|                                          |   (Donut)                    |
+------------------------------------------+------------------------------+
|                                          |                              |
|     Quality Metrics Over Time            |   Journey Outcomes           |
|     (Multi-line: Success, Null, Abandon) |   (Donut)                    |
|                                          |                              |
+------------------------------------------+------------------------------+
|                                                                         |
|     Daily Details Table                                                 |
|     (Date, Searches, Users, Success%, Null%, etc.)                     |
|                                                                         |
+------------------------------------------------------------------------+
```
